<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ex.mater.machinery.MachineryMapper">

	<resultMap id="fileCommand" type="com.ex.mater.mater.FileCommand">
		<result column="MTRI_MNPB_ASK_YYMM" property="mrtiMnpbAskYYMM"/>
		<result column="FILD_CLSS_CD" property="fildClssCd"/>
		<result column="CNTC_WKSC_CD" property="cntcWkscCd"/>
		<result column="CNTRT_CRPR_CD" property="cntrtCrprNm"/>
		<result column="MTRI_NM" property="mtriNm"/>
		<result column="CUST_TELNO" property="custTelno"/>
		<result column="MTRI_CUST_NO" property="mtriCustNo"/>
		<result column="RPPR_NM" property="rpprNm"/>
		<result column="DEPR_NM" property="deprNm"/>
		<result column="TR_BANK_NM" property="trBankNm"/>
		<result column="BANK_ACTNO" property="bankActno"/>
		<result column="ASK_AMT" property="askAmt"/>
		<result column="ATTFL_NM" property="attflNm"/>
		<result column="ATTFL_PATH" property="attflPath"/>
		<result column="ATTFL_SEQ" property="attflSeq"/>
		<result column="MTRI_CD" property="mtriCd"/>
		<result column="MTRI_MNPB_ASK_SQNO" property="mtriMnpbAskSqno"/>
		<result column="CNTRT_CRPR_CD" property="cntrtCrprCd"/>
		<result column="CNTRT_NO" property="cntrtNo"/>
		<result column="DLGD_AMNT" property="dlgdAmnt"/>
		<result column="DLGD_UNPR" property="dlgdUnpr"/>
		<result column="RGST_STAT" property="rgstStat"/>
		<result column="PPS_TRNM_YN" property="ppsTrnmYn"/>
		<result column="FSTTM_RGSR_ID" property="fsttmRgsrId"/>
		<result column="LSTTM_MODFR_ID" property="lsttmModfrId"/>
		<result column="ETC_RMRK" property="etcRmrk"/>
		<result column="CNTRT_CRPR_NM" property="cntrtCrprNm"/>
		<result column="CUST_NM" property="custNm"/>
	</resultMap>
	
    <insert id="insertMachineryList" parameterType="com.ex.mater.mater.FileCommand">
    	INSERT INTO T_EQPM_MNPB_01M1
    	(
	    	  EQPM_MNPB_ASK_YYMM
			, MTRI_CUST_NO
			, EQPM_CD
			, EQPM_MNPB_ASK_SQNO
			, FILD_CLSS_CD
			, CNTC_WKSC_CD
			, CNTRT_CRPR_CD
			, CNTRT_NO
			, EQPM_NM
			, DLGD_AMNT
			, DLGD_UNPR
			, ASK_AMT
			, RGST_STAT
			, PPS_TRNM_YN
			, FSTTM_RGSR_ID
			, FSTTM_RGST_DTTM
			, LSTTM_MODFR_ID
			, LSTTM_ALTR_DTTM
			, ETC_RMRK
			, ATTFL_SEQ
			, CNTRT_CRPR_NM
    	) VALUES (
 	    	  #{mrtiMnpbAskYYMM}
			, #{mtriCustNo}
			, #{mtriCd}
			, #{mtriMnpbAskSqno}
			, #{fildClssCd}
			, #{cntcWkscCd}
			, #{cntrtCrprCd}
			, #{cntrtNo}
			, #{mtriNm}
			, #{dlgdAmnt}
			, #{dlgdUnpr}
			, #{askAmt}
			, #{rgstStat}
			, #{ppsTrnmYn}
			, #{fsttmRgsrId}
			, SYSDATE
			, #{lsttmModfrId}
			, SYSDATE
			, #{etcRmrk}
			, #{attflSeq}
			, #{cntrtCrprNm}   	
    	)
    </insert>
    
    <insert id="insertMachineryAttfl" parameterType="com.ex.mater.mater.FileCommand">
    	<selectKey resultType="String" keyProperty="attflSeq" order="BEFORE">
			SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(NVL(MAX(TO_NUMBER(SUBSTR(ATTFL_SEQ, 9,6)))+1, 1),4, '0') as attflSeq 
			 FROM T_MTRI_ATTFL 
			  WHERE ATTFL_SEQ LIKE TO_CHAR(SYSDATE, 'YYYYMMDD')||'%'
		</selectKey>
    	INSERT INTO T_MTRI_ATTFL (
    		  ATTFL_SEQ
    		, ATTFL_SQNO
    		, ATTFL_NM
    		, ATTFL_PATH
    	) VALUES(
    		  #{attflSeq}
    		, 1
    		, #{attflNm}
    		, #{attflPath}
    	)
    </insert>
    
</mapper>
